var x=Object.defineProperty;var A=(o,t,e)=>t in o?x(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var d=(o,t,e)=>(A(o,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();function p(o,t){for(const e in t)!t[e]||typeof t[e]=="function"||(o[e]=t[e]);return o}function y(o){try{const t={};for(const e in o)o[e]&&(t[e]=o[e]);return JSON.parse(JSON.stringify(t))}catch(t){throw t}}function N(){return{reportId:Math.random().toString(16).slice(2),date:new Date().toISOString(),timezone:new Date().getTimezoneOffset()}}function C(){try{const o=p({},performance);return o.eventCounts={},p(o.eventCounts,performance.eventCounts),o.memory={},p(o.memory,performance.memory||console.memory||{}),y(o)}catch(o){return{error:o}}}async function b(o){try{const t=p({},navigator.connection);try{const r=await(await fetch("https://api.ipify.org/?format=json")).json();t.ipAddress=r.ip}catch(e){t.ipAddress={error:e}}if(o)try{const e=performance.now(),r=new Image;await new Promise(n=>{r.onload=n,r.onerror=n,r.src=o}),t.ping=performance.now()-e}catch(e){t.ping={error:e}}return y(t)}catch(t){return{error:t}}}function F(){try{return{innerWidth:window.innerWidth,innerHeight:window.innerHeight,pixelRatio:window.devicePixelRatio,href:window.location.href,title:window.document.title,isEmbedded:window.top!==window.self,referrer:document.referrer}}catch(o){return{error:o}}}function k(){try{return{language:navigator.language,languages:navigator.languages,userAgent:navigator.userAgent,deviceMemory:navigator.deviceMemory||-1,doNotTrack:navigator.doNotTrack,hardwareConcurrency:navigator.hardwareConcurrency||-1,maxTouchPoints:navigator.maxTouchPoints||0}}catch(o){return{error:o}}}function T(){try{const t=document.createElement("canvas").getContext("webgl");if(!t)return{error:new Error("Unable to get WebGL context.")};const e=t.getExtension("WEBGL_debug_renderer_info");return{renderer:t.getParameter(t.RENDERER),rendererUnmasked:e&&t.getParameter(e.UNMASKED_RENDERER_WEBGL),vendor:t.getParameter(t.VENDOR),vendorUnmasked:e&&t.getParameter(e.UNMASKED_VENDOR_WEBGL)}}catch(o){return{error:o}}}async function M(o,t){try{const e=document.createElement("canvas"),r=Math.min(512/e.width,512/e.height);e.width=e.width*r,e.height=e.height*r;const n=e.getContext("2d");return t&&await t(),n.drawImage(o,0,0,e.width,e.height),e.toDataURL("image/jpeg",65)}catch(e){return{error:e}}}function O(){try{return new Promise((o,t)=>{navigator.geolocation.getCurrentPosition(e=>o(y(e.coords)),e=>t({error:e}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})})}catch(o){return{error:o}}}async function K(o={}){try{const e=new TextEncoder().encode(JSON.stringify({...k(),...T(),...b(),additionalInfo:o})),r=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(r)).map(i=>i.toString(16).padStart(2,"0")).join("")}catch(t){return{error:t}}}function P(o=20){window.__frameTime=0;let t=performance.now();return()=>{const r=performance.now()-t;window.__frameTime+=(r-window.__frameTime)/o,t=performance.now()}}function h(){try{return window.__frameTime===void 0?-1:(1e3/window.__frameTime).toFixed(1)}catch(o){return{error:o}}}class D{constructor(t){d(this,"_options");d(this,"_lastError");d(this,"onTick");d(this,"_fpsTickInterval");d(this,"_fpsEl");var e,r,n;if(this._options=t,this.onTick=P(),((e=this._options.reports)==null?void 0:e.lastError)!==!1&&(window.onerror=(i,a,c)=>{this._lastError=[i,a,c]}),this._options.attachToWindow&&(window.__generateReport=this.generateReport.bind(this),window.__toggleFps=this.showFps.call(this,this._fpsEl)),(r=this._options.keyboardShortcuts)!=null&&r.generateReport){const i=this._options.keyboardShortcuts.generateReport;window.addEventListener("keydown",a=>{if(a.key.toLowerCase()===i.key.toLowerCase()){if(i.altKey&&!a.altKey||i.ctrlKey&&!a.ctrlKey||i.shiftKey&&!a.shiftKey||i.metaKey&&!a.metaKey)return;this.generateReport()}})}if((n=this._options.keyboardShortcuts)!=null&&n.toggleFps){const i=this._options.keyboardShortcuts.toggleFps;window.addEventListener("keydown",a=>{if(a.key.toLowerCase()===i.key.toLowerCase()){if(i.altKey&&!a.altKey||i.ctrlKey&&!a.ctrlKey||i.shiftKey&&!a.shiftKey||i.metaKey&&!a.metaKey)return;this.showFps(!this._fpsEl)}})}}showFps(t=!0){if(!(t&&this._fpsEl))if(t){const e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.right="0",e.style.zIndex=Number.MAX_SAFE_INTEGER.toString(),e.style.backgroundColor="#000",e.style.color="#fff",e.style.fontFamily="monospace",e.style.fontSize="12px",e.style.padding="5px";const r=h();e.innerHTML=`FPS: ${r}`,this._fpsEl=e,document.body.appendChild(e),clearInterval(this._fpsTickInterval),this._fpsTickInterval=setInterval(()=>{if(!this._fpsEl)return;const n=h();this._fpsEl.innerHTML=`FPS: ${n}`},1e3)}else this._fpsEl&&(document.body.removeChild(this._fpsEl),this._fpsEl=void 0),clearInterval(this._fpsTickInterval)}hideFps(){this.showFps(!1)}setFingerprintInfo(t){this._options.additionalFingerprintInfo=t}async getFingerprint(){return await K(this._options.additionalFingerprintInfo)}async generateReport(){const t=this._options.getAdditionalInfo?await this._options.getAdditionalInfo():{},e={...N(),gameName:this._options.gameName,gameVersion:this._options.gameVersion,additionalInfo:t},r=this._options.reports||{};if(r.performance!==!1&&(e.performance=C()),r.network!==!1&&(e.network=await b(this._options.pingUrl)),r.window!==!1&&(e.window=F()),r.device!==!1&&(e.device=k()),r.graphicsDevice!==!1&&(e.graphicsDevice=T()),r.screenshot!==!1){if(!this._options.canvasEl)throw new Error("No canvas element provided for screenshot.");e.screenshot=await M(this._options.canvasEl,this._options.canvasRenderFn)}r.location&&(e.location=await O()),r.fingerprint!==!1&&(e.fingerprint=await this.getFingerprint()),r.fps!==!1&&(e.fps=h()),r.lastError!==!1&&(e.lastError=this._lastError);const n=JSON.stringify(e),i=btoa(n);if(this._options.outputToConsole&&(console.log("=== Game Doctor Diagnostic Report ==="),console.log(JSON.stringify(JSON.parse(n),null,4)),console.log("=== End of Report ===")),this._options.outputFormat==="image/png"){const a=this._encodeReportAsImage(e.reportId,i),c=a.toDataURL("image/png"),s=await new Promise(l=>{a.toBlob(E=>l(E),"image/png")});return this._options.copyToClipboard&&navigator.clipboard.write([new ClipboardItem({"image/png":s})]),c}else{const a=this._options.outputFormat==="base64"?i:n;return this._options.copyToClipboard&&navigator.clipboard.writeText(a),a}}static decodeBase64(t){return JSON.parse(atob(t))}_encodeReportAsImage(t,e){const r=document.createElement("canvas"),n=r.getContext("2d");r.width=Math.ceil(Math.sqrt(e.length)),r.height=r.width;let i;this._options.overlayImage&&(n.drawImage(this._options.overlayImage,0,0,r.width,r.height),i=n.getImageData(0,0,r.width,r.height)),r.width=Math.ceil(Math.sqrt(e.length)),r.height=r.width,n.fillStyle="#000",n.fillRect(0,0,r.width,r.height),n.font="12px monospace",n.fillStyle="#f00",n.fillText(t,5,15);const a=n.getImageData(0,0,r.width,r.height),c=a.data;for(let s=0;s<e.length;s++){const l=s%r.width,f=(Math.floor(s/r.width)*r.width+l)*4,S=e[s].charCodeAt(0);c[f+1]=i?i.data[f+1]:0,c[f+2]=S,c[f+3]=255}return n.putImageData(a,0,0),r}static async decodeImageUrl(t){const e=new Image;e.src=t,await new Promise(s=>{e.onload=s});const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const n=r.getContext("2d");n.drawImage(e,0,0);const a=n.getImageData(0,0,r.width,r.height).data;let c="";for(let s=0;s<a.length;s+=4){const l=a[s+2];if(l===0)break;c+=String.fromCharCode(l)}return this.decodeBase64(c)}static async decodeImage(t){const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),await this.decodeImageUrl(e.toDataURL("image/png"))}}const w=document.getElementById("app"),_=document.getElementById("reportOutput"),u=document.getElementById("reportInputTextarea"),B=document.getElementById("printButton"),U=document.getElementById("resetButton"),$=document.getElementById("reportTitle");let I="ready";const v=o=>{const t=document.querySelectorAll(`[data-view=${I}]`);for(let r of Array.from(t))r.style.display="none";const e=document.querySelectorAll(`[data-view=${o}]`);for(let r of Array.from(e))r.style.display="block";I=o,w.setAttribute("data-current-view",o)},g=()=>{v("ready"),u.value="",_.innerHTML="",document.title="Game Doctor by Two-Cat Moon"},R=o=>o.replace(/([A-Z])/g," $1").replace(/^./,t=>t.toUpperCase()),m=o=>{if(o===null)return"NULL";if(o===void 0)return"UNDEFINED";if(Array.isArray(o)){let e="<ul>";for(let r of o)typeof r=="object"?e+="<li>"+m(r)+"</li>":e+=`<li>${r}</li>`;return e+="</ul>",e}let t="<table>";for(let e of Object.keys(o))t+="<tr>",t+=`<td><strong>${R(e)}</strong></td>`,typeof o[e]=="object"?t+="<td>"+m(o[e])+"</td>":t+=`<td>${o[e]}</td>`,t+="</tr>";return t+="</table>",t},L=o=>{$.innerHTML=`Diagnostic Report for ${o.gameName}`,document.title=`Diagnostic Report for ${o.gameName}`;let t="";for(let e of Object.keys(o)){let r="<section>";r+=`<h3>${R(e)}</h3>`,e==="screenshot"?r+=`<img src="${o[e]}" alt="screenshot" />`:typeof o[e]=="object"?r+=m(o[e]):r+=`${o[e]}`,r+="</section>",t+=r}return t};u.addEventListener("input",async()=>{const o=u.value;try{const t=await D.decodeBase64(o),e=L(t);_.innerHTML=e,v("report")}catch{g()}});w.addEventListener("dragover",o=>{o.preventDefault(),o.stopPropagation()});w.addEventListener("drop",o=>{o.preventDefault(),o.stopPropagation();try{const t=o.dataTransfer.files[0],e=new FileReader;e.onerror=()=>{g()},e.onload=async r=>{const n=r.target.result,i=await D.decodeImageUrl(n),a=L(i);_.innerHTML=a,v("report")},e.readAsDataURL(t)}catch{g()}});B.addEventListener("click",()=>{window.print()});U.addEventListener("click",()=>{g()});
